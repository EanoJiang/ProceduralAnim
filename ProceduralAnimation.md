# 程序化Locomoition角色控制器

## 第一个程序动画

创建一个control rig

![1771432079406](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260219003736840-1957939409.png)

control rig蓝图中，获取骨骼的transform，暂时先控制pelvis来验证该功能，选择Space为全局空间，让过渡Translation的Z轴附加一个sin函数，模拟身体上下浮动

![1771432273355](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260219003737343-1767167385.png)

选择Use Specific Animation

![1771432468447](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260219003737557-304339491.png)

效果：

![1771432739182](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260219003908933-1333027228.gif)

## 腿部IK

### 设置好腿部IK链：thigh-calf-foot，Efector设置为ik_foot

![1771696491553](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025711404-969884943.png)

### 这里还需要设置主次朝向，也就是Primary和Secondaru Axis

Primary Axis为Item A(也就是thigh)，Secondaru Axis为Item B(也就是calf)

thigh_l的坐标系如图(红绿蓝分别对应xyz)：

![1771696810920](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025711855-419014939.png)

calf_l的坐标系如图：

![1771696918143](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025712047-1385117244.png)

大腿需要朝向下，膝盖需要朝向正前

因此Primary Axis的x=-1，Secondaru Axis的y=1

![1771697607866](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025712498-973873507.png)

**Pole Vector（极向量）** ：控制 IK 的关节弯曲方向

因此设置朝向正前

![1771697799806](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025712863-667743868.png)

效果：

![1771698439534](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025713196-595031713.gif)

把控制脚部偏移的节点加进来

![1771699821664](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025713546-251428571.png)

### 用循环来为左右脚都设置IK

先建立一个脚部Transform的列表

![1771713374328](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025713812-1092341731.png)

然后给左右脚都设置好ik，因为右脚的骨骼朝向与左脚相反，所以当index!=0时主次轴朝向都需要乘-1

![1771713587578](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025714045-879843016.png)

效果：

![1771715122305](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025714283-401710303.png)

暂时先删去脚部偏移

![1771721536395](https://img2024.cnblogs.com/blog/3614909/202602/3614909-20260224025714480-1606346751.png)

### 显示脚部位置偏移的轨迹(Sphere Trace)
